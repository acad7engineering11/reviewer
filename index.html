<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEM 11 ENGINEERING REVIEWER</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- MathJax CDN for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        // MathJax configuration to process inline math with $...$ and display math with $$...$$
        window.MathJax = {
            tex: {
                inlineMath: [
                    ['$', '$'],
                    ['\\(', '\\)']
                ],
                displayMath: [
                    ['$$', '$$'],
                    ['\\[', '\\]']
                ]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            /* Light gray background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            margin-top: 1rem;
        }

        .container>div {
            padding: 1rem;
        }

        .slide-container {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            /* For smooth scrolling on iOS */
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE and Edge */
        }

        .slide-container::-webkit-scrollbar {
            display: none;
        }

        .question-slide {
            flex: 0 0 100%;
            scroll-snap-align: start;
            min-width: 100%;
        }

        .hidden {
            display: none;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #000;
            animation: spin 1s ease infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .question-container {
            min-height: 200px;
        }
    </style>
</head>

<body>
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="spinner"></div>
    </div>
    <div class="container mx-auto">
        <!-- Main Application View -->
        <div id="main-view" class="text-gray-800">
            <header class="text-center mb-6">
                <h1 class="text-3xl font-bold text-gray-900">STEM 11 ENGINEERING REVIEWER</h1>
                <p class="mt-2 text-md text-gray-600">Prepare for your exams and review guide lessons with this interactive tool.</p>
            </header>

            <!-- Home Section -->
            <div id="home-section" class="flex flex-col items-center justify-center p-6 space-y-4">
                <h2 class="text-2xl font-semibold mb-4">Choose a Section</h2>
                <button id="exams-btn" class="w-full max-w-sm px-6 py-3 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 transition-colors">
                    Exams
                </button>
                <button id="guide-lessons-btn" class="w-full max-w-sm px-6 py-3 bg-green-600 text-white rounded-lg shadow-md hover:bg-green-700 transition-colors">
                    Guide Lessons
                </button>
            </div>

            <!-- Exams Section -->
            <div id="exams-section" class="hidden p-6 space-y-6">
                <h2 class="text-2xl font-semibold text-center mb-4">Exams</h2>
                <div class="flex flex-col items-center space-y-4">
                    <label for="exam-quarter-dropdown" class="block text-sm font-medium text-gray-700">Select Exam Quarter</label>
                    <select id="exam-quarter-dropdown" class="mt-1 block w-full max-w-sm pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                        <option value="">Select a quarter...</option>
                    </select>

                    <div id="exam-selection-container" class="w-full hidden">
                        <label for="exam-dropdown" class="block text-sm font-medium text-gray-700 mt-4">Select Exam</label>
                        <select id="exam-dropdown" class="mt-1 block w-full max-w-sm pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="">Select an exam...</option>
                        </select>
                    </div>

                    <button id="start-exam-btn" class="w-full max-w-sm px-6 py-3 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 transition-colors hidden">
                        Start Exam
                    </button>
                    <button id="back-from-exams-btn" class="w-full max-w-sm px-6 py-3 bg-gray-400 text-white rounded-lg shadow-md hover:bg-gray-500 transition-colors">
                        Back to Home
                    </button>
                </div>
            </div>

            <!-- Guide Lessons Section -->
            <div id="guide-lessons-section" class="hidden p-6 space-y-6">
                <h2 class="text-2xl font-semibold text-center mb-4">Guide Lessons</h2>
                <div class="flex flex-col items-center space-y-4">
                    <label for="lesson-quarter-dropdown" class="block text-sm font-medium text-gray-700">Select Lesson Quarter</label>
                    <select id="lesson-quarter-dropdown" class="mt-1 block w-full max-w-sm pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md">
                        <option value="">Select a quarter...</option>
                    </select>

                    <div id="lesson-selection-container" class="w-full hidden">
                        <label for="lesson-dropdown" class="block text-sm font-medium text-gray-700 mt-4">Select Lesson</label>
                        <select id="lesson-dropdown" class="mt-1 block w-full max-w-sm pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md">
                            <option value="">Select a lesson...</option>
                        </select>
                        <button id="start-lesson-btn" class="w-full max-w-sm px-6 py-3 mt-4 bg-green-600 text-white rounded-lg shadow-md hover:bg-green-700 transition-colors hidden">
                            Start Lesson
                        </button>
                    </div>

                    <button id="back-from-lessons-btn" class="w-full max-w-sm px-6 py-3 bg-gray-400 text-white rounded-lg shadow-md hover:bg-gray-500 transition-colors">
                        Back to Home
                    </button>
                </div>
            </div>

            <!-- Quiz Section -->
            <div id="quiz-section" class="hidden p-6">
                <header class="text-center mb-6">
                    <h2 id="quiz-title" class="text-2xl font-semibold text-gray-900"></h2>
                    <p id="question-counter" class="text-sm text-gray-500"></p>
                    <p id="error-message" class="text-red-500 mt-2 hidden">An error occurred.</p>
                </header>

                <div id="questions-slide-container" class="slide-container mb-6 overflow-hidden relative">
                    <!-- Question slides will be injected here -->
                </div>

                <div class="flex justify-between items-center mt-4">
                    <button id="prev-question-btn" class="px-4 py-2 bg-indigo-500 text-white rounded-lg shadow-md hover:bg-indigo-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">Previous</button>
                    <button id="next-question-btn" class="px-4 py-2 bg-indigo-500 text-white rounded-lg shadow-md hover:bg-indigo-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">Next</button>
                </div>
            </div>

            <!-- Results Section -->
            <div id="results-section" class="hidden p-6">
                <header class="text-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-900">Quiz Results</h2>
                </header>
                <div class="text-center space-y-2 mb-6">
                    <p class="text-xl font-bold text-gray-700">Your Score: <span id="score-display" class="text-indigo-600"></span></p>
                    <p id="percentage-display" class="text-lg text-gray-600"></p>
                </div>
                <div id="feedback-container" class="space-y-4">
                    <!-- Feedback will be injected here -->
                </div>
                <div class="flex justify-center mt-6">
                    <button id="retake-quiz-btn" class="px-6 py-3 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 transition-colors">Retake Quiz</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const contentData = {
            "exams": {
                "1st Quarter": [{
                    "name": "Finite Math (Easy)",
                    "file": "finite_math (easy).json"
                }, {
                    "name": "Finite Math (Hard)",
                    "file": "finite_math (hard).json"
                }, {
                    "name": "General Science (Easy)",
                    "file": "gensci (easy).json"
                }, {
                    "name": "General Science (Hard)",
                    "file": "gensci (hard).json"
                }],
                "2nd Quarter": [],
                "3rd Quarter": [],
                "4th Quarter": []
            },
            "guide lessons": {
                "1st Quarter": [{
                    "name": "Q1 General Science (Louise Pasteur)",
                    "file": "q1_gen sci (louise pasteur).json"
                }],
                "2nd Quarter": [],
                "3rd Quarter": [],
                "4th Quarter": []
            }
        };

        // DOM Elements
        const mainView = document.getElementById('main-view');
        const homeSection = document.getElementById('home-section');
        const examsSection = document.getElementById('exams-section');
        const guideLessonsSection = document.getElementById('guide-lessons-section');
        const quizSection = document.getElementById('quiz-section');
        const resultsSection = document.getElementById('results-section');

        const examsBtn = document.getElementById('exams-btn');
        const guideLessonsBtn = document.getElementById('guide-lessons-btn');
        const backFromExamsBtn = document.getElementById('back-from-exams-btn');
        const backFromLessonsBtn = document.getElementById('back-from-lessons-btn');

        const examQuarterDropdown = document.getElementById('exam-quarter-dropdown');
        const examSelectionContainer = document.getElementById('exam-selection-container');
        const examDropdown = document.getElementById('exam-dropdown');
        const startExamBtn = document.getElementById('start-exam-btn');

        const lessonQuarterDropdown = document.getElementById('lesson-quarter-dropdown');
        const lessonSelectionContainer = document.getElementById('lesson-selection-container');
        const lessonDropdown = document.getElementById('lesson-dropdown');
        const startLessonBtn = document.getElementById('start-lesson-btn'); // New button for lessons

        const quizTitleElement = document.getElementById('quiz-title');
        const questionsSlideContainer = document.getElementById('questions-slide-container');
        const questionCounter = document.getElementById('question-counter');
        const prevQuestionButton = document.getElementById('prev-question-btn');
        const nextQuestionButton = document.getElementById('next-question-btn');
        const errorMessageElement = document.getElementById('error-message');

        const scoreDisplay = document.getElementById('score-display');
        const percentageDisplay = document.getElementById('percentage-display');
        const feedbackContainer = document.getElementById('feedback-container');
        const retakeQuizBtn = document.getElementById('retake-quiz-btn');
        const loadingOverlay = document.getElementById('loadingOverlay');

        // State Variables
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let score = 0;

        // Utility Functions
        function navigateTo(sectionId) {
            homeSection.classList.add('hidden');
            examsSection.classList.add('hidden');
            guideLessonsSection.classList.add('hidden');
            quizSection.classList.add('hidden');
            resultsSection.classList.add('hidden');
            document.getElementById(sectionId).classList.remove('hidden');
            hideError();
        }

        function showLoading() {
            loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }

        function showError(message) {
            errorMessageElement.textContent = message;
            errorMessageElement.classList.remove('hidden');
        }

        function hideError() {
            errorMessageElement.classList.add('hidden');
        }

        // Event Listeners for Navigation
        examsBtn.addEventListener('click', () => {
            populateQuarterDropdown(examQuarterDropdown, 'exams');
            navigateTo('exams-section');
        });

        guideLessonsBtn.addEventListener('click', () => {
            populateQuarterDropdown(lessonQuarterDropdown, 'guide lessons');
            navigateTo('guide-lessons-section');
        });

        backFromExamsBtn.addEventListener('click', () => {
            navigateTo('home-section');
        });

        backFromLessonsBtn.addEventListener('click', () => {
            navigateTo('home-section');
        });

        function populateQuarterDropdown(dropdown, type) {
            if (!contentData) return;
            dropdown.innerHTML = '<option value="">Select a quarter...</option>';
            const quarters = Object.keys(contentData[type]);
            quarters.forEach(quarter => {
                const option = document.createElement('option');
                option.value = quarter;
                option.textContent = quarter;
                if (contentData[type][quarter].length === 0) {
                    option.disabled = true;
                    option.textContent += ' (Coming Soon)';
                }
                dropdown.appendChild(option);
            });
        }

        function populateContentDropdown(quarterDropdown, contentDropdown, type) {
            const quarter = quarterDropdown.value;
            contentDropdown.innerHTML = `<option value="">Select a ${type === 'exams' ? 'exam' : 'lesson'}...</option>`;
            if (quarter && contentData && contentData[type][quarter]) {
                const items = contentData[type][quarter];
                items.forEach((item, index) => {
                    const option = document.createElement('option');
                    option.value = item.file;
                    option.textContent = item.name;
                    contentDropdown.appendChild(option);
                });
            }
        }

        examQuarterDropdown.addEventListener('change', () => {
            examSelectionContainer.classList.add('hidden');
            startExamBtn.classList.add('hidden');
            if (examQuarterDropdown.value) {
                examSelectionContainer.classList.remove('hidden');
                populateContentDropdown(examQuarterDropdown, examDropdown, 'exams');
            }
        });

        examDropdown.addEventListener('change', () => {
            if (examDropdown.value) {
                startExamBtn.classList.remove('hidden');
            } else {
                startExamBtn.classList.add('hidden');
            }
        });

        lessonQuarterDropdown.addEventListener('change', () => {
            lessonSelectionContainer.classList.add('hidden');
            if (lessonQuarterDropdown.value) {
                lessonSelectionContainer.classList.remove('hidden');
                populateContentDropdown(lessonQuarterDropdown, lessonDropdown, 'guide lessons');
            }
        });
        
        // New event listener for the lesson dropdown to show the "Start Lesson" button
        lessonDropdown.addEventListener('change', () => {
            if (lessonDropdown.value) {
                startLessonBtn.classList.remove('hidden');
            } else {
                startLessonBtn.classList.add('hidden');
            }
        });

        startExamBtn.addEventListener('click', () => {
            const quarter = examQuarterDropdown.value;
            const filePath = examDropdown.value;
            if (quarter && filePath) {
                showLoading();
                fetch(filePath)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Failed to load ${filePath}: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        hideLoading();
                        startQuiz(data.title, data.questions);
                    })
                    .catch(error => {
                        hideLoading();
                        showError(error.message);
                        console.error("Error loading exam data:", error);
                    });
            } else {
                showError("Please select an exam to start.");
            }
        });
        
        // New event listener for the lesson "Start" button
        startLessonBtn.addEventListener('click', () => {
            const filePath = lessonDropdown.value;
            if (filePath) {
                showLoading();
                fetch(filePath)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Failed to load ${filePath}: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        hideLoading();
                        startQuiz(data.title, data.questions);
                    })
                    .catch(error => {
                        hideLoading();
                        showError(error.message);
                        console.error("Error loading lesson data:", error);
                    });
            } else {
                showError("Please select a lesson to start.");
            }
        });

        function startQuiz(title, questions) {
            currentQuestions = questions;
            currentQuestionIndex = 0;
            userAnswers = Array(currentQuestions.length).fill(null);
            score = 0;
            quizTitleElement.textContent = title;
            renderQuiz();
            navigateTo('quiz-section');
        }

        function renderQuiz() {
            questionsSlideContainer.innerHTML = '';
            currentQuestions.forEach((q, index) => {
                const questionElement = createQuestionElement(q, index);
                questionsSlideContainer.appendChild(questionElement);
            });
            updateNavigationButtons();
            updateQuestionCounter();
            questionsSlideContainer.scrollLeft = 0;
            MathJax.typesetPromise();
        }

        function createQuestionElement(questionData, index) {
            const slide = document.createElement('div');
            slide.className = 'question-slide p-4 border-b border-gray-200';
            slide.setAttribute('data-index', index);

            const questionContainer = document.createElement('div');
            questionContainer.className = 'question-container mb-4 text-center';

            const questionText = document.createElement('div');
            questionText.className = 'text-lg font-medium text-gray-800 mb-4';
            questionText.innerHTML = `Question ${index + 1}: ${questionData.question}`;
            questionContainer.appendChild(questionText);

            const optionsList = document.createElement('div');
            optionsList.className = 'flex flex-col space-y-2';

            questionData.options.forEach((option, optionIndex) => {
                const label = document.createElement('label');
                label.className = 'flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer transition-colors hover:bg-gray-100';

                const input = document.createElement('input');
                input.type = 'radio';
                input.name = `question-${index}`;
                input.value = option;
                input.className = 'mr-3 h-5 w-5 text-indigo-600 border-gray-300 focus:ring-indigo-500';
                input.addEventListener('change', () => {
                    userAnswers[index] = option;
                    updateNavigationButtons();
                });

                const span = document.createElement('span');
                span.className = 'text-gray-700';
                span.innerHTML = option;

                label.appendChild(input);
                label.appendChild(span);
                optionsList.appendChild(label);
            });

            slide.appendChild(questionContainer);
            slide.appendChild(optionsList);
            return slide;
        }

        function updateNavigationButtons() {
            prevQuestionButton.disabled = currentQuestionIndex === 0;
            nextQuestionButton.disabled = userAnswers[currentQuestionIndex] === null;

            if (currentQuestionIndex === currentQuestions.length - 1 && userAnswers[currentQuestionIndex] !== null) {
                nextQuestionButton.textContent = 'Submit Quiz';
            } else {
                nextQuestionButton.textContent = 'Next';
            }
        }

        function updateQuestionCounter() {
            questionCounter.textContent = `Question ${currentQuestionIndex + 1} of ${currentQuestions.length}`;
        }

        prevQuestionButton.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                scrollToQuestion(currentQuestionIndex);
            }
        });

        nextQuestionButton.addEventListener('click', () => {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                scrollToQuestion(currentQuestionIndex);
            } else if (currentQuestionIndex === currentQuestions.length - 1 && userAnswers[currentQuestionIndex] !== null) {
                submitQuiz();
            }
        });

        function scrollToQuestion(index) {
            const slideWidth = questionsSlideContainer.clientWidth;
            questionsSlideContainer.scroll({
                left: index * slideWidth,
                behavior: 'smooth'
            });
            updateQuestionCounter();
            updateNavigationButtons();
            // Re-check answers after scrolling
            const currentQuestionElement = questionsSlideContainer.querySelector(`[data-index="${index}"]`);
            if (userAnswers[index] !== null) {
                const radio = currentQuestionElement.querySelector(`input[value="${userAnswers[index]}"]`);
                if (radio) {
                    radio.checked = true;
                }
            }
            MathJax.typesetPromise();
        }

        function submitQuiz() {
            score = 0;
            feedbackContainer.innerHTML = '';
            currentQuestions.forEach((q, index) => {
                if (userAnswers[index] === q.correctAnswer) {
                    score++;
                }
                renderFeedback(q, userAnswers[index], index);
            });
            displayResults();
        }

        function renderFeedback(questionData, userAnswer, index) {
            const isCorrect = userAnswer === questionData.correctAnswer;
            const feedbackItem = document.createElement('div');
            feedbackItem.className = `p-4 rounded-lg shadow-sm border ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`;
            feedbackItem.innerHTML = `
                <p class="font-semibold text-gray-800">Question ${index + 1}:</p>
                <div class="mt-1 mb-2 text-gray-700">${questionData.question}</div>
                <p class="text-sm">Your Answer: <span class="font-medium ${isCorrect ? 'text-green-600' : 'text-red-600'}">${userAnswer || 'Not answered'}</span></p>
                <p class="text-sm">Correct Answer: <span class="font-medium text-green-600">${questionData.correctAnswer}</span></p>
            `;
            feedbackContainer.appendChild(feedbackItem);
            MathJax.typesetPromise([feedbackItem]).catch((err) => console.error("MathJax typesetting error in feedback:", err));
        }

        function displayResults() {
            scoreDisplay.textContent = `${score} / ${currentQuestions.length}`;
            const percentage = (score / currentQuestions.length) * 100;
            percentageDisplay.textContent = `${percentage.toFixed(2)}%`;
            navigateTo('results-section');
        }

        retakeQuizBtn.addEventListener('click', () => {
            // Reset to the initial state
            navigateTo('home-section');
            examQuarterDropdown.value = '';
            examDropdown.innerHTML = '<option value="">Select an exam...</option>';
            examSelectionContainer.classList.add('hidden');
            startExamBtn.classList.add('hidden');
        });
    </script>
</body>

</html>
